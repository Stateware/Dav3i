/*! Dav3i - v0.1.0 - 2015-09-01
* https://github.com/Stateware/Dav3i
* Copyright (c) 2015 Stateware Team;
 Licensed GPL v3 (https://github.com/Stateware/Dav3i/blob/master/LICENSE) */
function t_AsdsNode(a,b,c){this.cc2=a,this.name=b,this.data=c,this.next=null}function c_List(){this.size=0,this.start=null,this.add=function(a){var b;b=this.start,this.start=a,this.start.next=b,this.size++},this.clear=function(){this.size=0,this.start=null}}function ColorByHms(){var a,b,c,d,e,f,g={};c=Number.MAX_VALUE,d=Number.MIN_VALUE;for(e in g_Map.regions)if(g_Map.regions.hasOwnProperty(e)&&void 0!==g_Data[e]){b="custom"!==g_StatId?g_Data[e][g_StatId].data:g_Data[e][g_StatId1].data;for(f in b)b[f].index===g_SelectedIndex&&(a=b[f].values);GetColor(a,g,e),void 0!==g[e]&&(Number(g[e])<c&&(c=g[e]),Number(g[e])>d&&(d=g[e]))}g_Map.series.regions[0].params.min=c,g_Map.series.regions[0].params.max=d,g_Map.reset(),Object.keys(g).length>0&&g_Map.series.regions[0].setValues(g)}function GetColor(a,b,c){"int"===g_Data[c][g_StatId].type?GetIntColor(a,b,c):"est"===g_Data[c][g_StatId].type?GetEstColor(a,b,c):GetOtherColor(a,b,c)}function GetIntColor(a,b,c){var d;"-1"!==a[g_IntHms].values["y_"+g_HmsYear]&&(d=a[g_IntHms].values["y_"+g_HmsYear],void 0!==d&&(b[c]=d))}function GetEstColor(a,b,c){var d;"-1"!==a[1]["y_"+g_HmsYear]&&(d=a[1]["y_"+g_HmsYear],void 0!==d&&(b[c]=d))}function GetOtherColor(a,b,c){var d;"-1"!==a["y_"+g_HmsYear]&&(d=a["y_"+g_HmsYear],void 0!==d&&(b[c]=d))}function ParseData(){$.when(GetData()).done(function(a){SetInitalYears(a),g_Data=a.country_data,g_Stats=a.stats,g_Countries=a.countries,g_Diseases=a.diseases,g_StatId=Object.keys(g_Stats)[0],g_StatId1=Object.keys(g_Stats)[0],g_StatId2=Object.keys(g_Stats)[0],g_SubStat1=0,g_SubStat2=0,g_HmsYear=g_LastYear,ColorByHms(),BuildTabs(),UpdateInputs(),SwitchToMain()})}function GetData(){return $.ajax({url:"API/get_data.php",dataType:"JSON",error:function(){console.log("Error receiving descriptor.php")},success:function(){console.log("Successfully received descriptor.php")}})}function SetInitalYears(a){g_FirstYear=Number(a.firstYear),g_YearStart=Number(a.firstYear),g_LastYear=Number(a.lastYear),g_YearEnd=Number(a.lastYear)}function SelectIndex(a){g_SelectedIndex=Number(a.value)}function BuildList(a){var b,c;for(null==g_DataList&&(g_DataList=new c_List),g_DataList.clear(),b=0;b<a.length;b++)void 0!==g_Data[a[b]]&&void 0!==g_Data[a[b]][g_StatId]&&(c=new t_AsdsNode(a[b],g_Countries[a[b]],g_Data[a[b]]),g_DataList.add(c))}function SetGraphType(a){g_GraphType=a}function SetIntHms(a){g_IntHms=a}function ApplyAndClose(){ApplySettings()&&CloseSettings()}function CancelSettings(){var a=document.getElementById("year-range-start"),b=document.getElementById("year-range-end"),c=document.getElementById("heatmap-year");a.style["box-shadow"]="none",b.style["box-shadow"]="none",c.style["box-shadow"]="none",document.getElementById(a.id+"-error").innerHTML="",document.getElementById(b.id+"-error").innerHTML="",document.getElementById(c.id+"-error").innerHTML="",ResetAllStatValues(),CloseSettings()}function ResetAllStatValues(){var a=document.getElementById("year-range-start"),b=document.getElementById("year-range-end"),c=document.getElementById("heatmap-year");switch(a.value=g_TempSettings[0],b.value=g_TempSettings[1],c.value=g_TempSettings[2],g_TempSettings[3]){case 0:document.getElementById("graph-regional").checked=!0;break;case 1:document.getElementById("graph-combined").checked=!0;break;case 2:document.getElementById("graph-whole").checked=!0}switch(g_TempSettings[4]){case 0:document.getElementById("int0").checked=!0;break;case 1:document.getElementById("int1").checked=!0;break;case 2:document.getElementById("int2").checked=!0}g_YearStart=g_TempSettings[0],g_YearEnd=g_TempSettings[1],g_HmsYear=g_TempSettings[2],g_GraphType=g_TempSettings[3],g_IntHMS=g_TempSettings[4]}function SaveCurrentStatValues(){var a=document.getElementById("year-range-start"),b=document.getElementById("year-range-end"),c=document.getElementById("heatmap-year");g_TempSettings[0]=a.value,g_TempSettings[1]=b.value,g_TempSettings[2]=c.value,g_TempSettings[3]=g_GraphType,g_TempSettings[4]=g_IntHms}function ApplySettings(){var a=!0,b=document.getElementById("year-range-start"),c=document.getElementById("year-range-end"),d=document.getElementById("heatmap-year");return b.style["box-shadow"]="",c.style["box-shadow"]="",d.style["box-shadow"]="",document.getElementById(b.id+"-error").style.cursor="default",document.getElementById(c.id+"-error").style.cursor="default",document.getElementById(d.id+"-error").style.cursor="default",document.getElementById(b.id+"-error").innerHTML="&emsp;",document.getElementById(c.id+"-error").innerHTML="&emsp;",document.getElementById(d.id+"-error").innerHTML="&emsp;",document.getElementById(b.id+"-error").removeAttribute("tooltip"),document.getElementById(c.id+"-error").removeAttribute("tooltip"),document.getElementById(d.id+"-error").removeAttribute("tooltip"),document.getElementById(b.id+"-error").className="",document.getElementById(c.id+"-error").className="",document.getElementById(d.id+"-error").className="",(""===b.value||Number(b.value)<Number(b.min)||Number(b.value)>Number(b.max)||isNaN(b.value))&&(a=!1,b.style["box-shadow"]="0px 0px 8px #F00",document.getElementById(b.id+"-error").style.cursor="help",document.getElementById(b.id+"-error").innerHTML="X",document.getElementById(b.id+"-error").setAttribute("tooltip","Out of range: "+b.min+"-"+b.max),document.getElementById(b.id+"-error").className="settings-error"),(""===c.value||Number(c.value)<Number(c.min)||Number(c.value)>Number(c.max)||isNaN(c.value))&&(a=!1,c.style["box-shadow"]="0px 0px 8px #F00",document.getElementById(c.id+"-error").style.cursor="help",document.getElementById(c.id+"-error").innerHTML="X",document.getElementById(c.id+"-error").setAttribute("tooltip","Out of range: "+c.min+"-"+c.max),document.getElementById(c.id+"-error").className="settings-error"),(""===d.value||Number(d.value)<Number(d.min)||Number(d.value)>Number(d.max)||isNaN(d.value))&&(a=!1,d.style["box-shadow"]="0px 0px 8px #F00",document.getElementById(d.id+"-error").style.cursor="help",document.getElementById(d.id+"-error").innerHTML="X",document.getElementById(d.id+"-error").setAttribute("tooltip","Out of range: "+d.min+"-"+d.max),document.getElementById(d.id+"-error").className="settings-error"),c.value<b.value&&(a=!1,b.style["box-shadow"]="0px 0px 8px #F00",c.style["box-shadow"]="0px 0px 8px #F00",document.getElementById(b.id+"-error").style.cursor="help",document.getElementById(c.id+"-error").style.cursor="help",document.getElementById(b.id+"-error").innerHTML="X",document.getElementById(c.id+"-error").innerHTML="X",document.getElementById(b.id+"-error").setAttribute("tooltip","Year must be before End."),document.getElementById(c.id+"-error").setAttribute("tooltip","Year must be after Start."),document.getElementById(b.id+"-error").className="settings-error",document.getElementById(c.id+"-error").className="settings-error"),a?(b.style["box-shadow"]="0px 0px 8px #00FF00",c.style["box-shadow"]="0px 0px 8px #00FF00",d.style["box-shadow"]="0px 0px 8px #00FF00",document.getElementById(b.id+"-error").innerHTML="&#10003",document.getElementById(c.id+"-error").innerHTML="&#10003",document.getElementById(d.id+"-error").innerHTML="&#10003",g_YearStart=b.value,g_YearEnd=c.value,g_HmsYear=d.value,GenerateSubDivs(),GenerateGraphs(),"custom"!==g_StatId&&ColorByHms(),SaveCurrentStatValues(),!0):!1}function SelectIndex(a){"stat1index"!==a&&"stat2index"!==a?g_SelectedIndex=document.getElementById(a).value:"stat1Index"===a?g_SelectedIndex1=document.getElementById(a).value:g_SelectedIndex2=document.getElementById(a).value,GenerateGraphs()}function SelectStat(a){var b,c=new RegExp("([a-z_]+)\\+?(\\d+)?");b=c.exec(document.getElementById(a).value),"stat1"===a?(g_StatId1=b[1],void 0!==b[2]&&(g_SubStat1=b[2]),RefreshIndices("stat1index"),g_SelectedIndex1=0):(g_StatId2=b[1],void 0!==b[2]&&(g_SubStat2=b[2]),RefreshIndices("stat2index"),g_SelectedIndex2=0),GenerateGraphs()}function BuildList(a){var b,c;for(null==g_DataList&&(g_DataList=new c_List),g_DataList.clear(),b=0;b<a.length;b++)void 0!==g_Data[a[b]]&&(void 0!==g_Data[a[b]][g_StatId]||"custom"===g_StatId&&void 0!==g_Data[a[b]][g_StatId1]&&void 0!==g_Data[a[b]][g_StatId2])&&(c=new t_AsdsNode(a[b],g_Countries[a[b]],g_Data[a[b]]),g_DataList.add(c))}function GenerateGraphs(){void 0!==g_DataList&&0!==g_DataList.size&&("custom"===g_StatId?GenerateCustomGraphs():"int"===g_Stats[g_StatId].type?GenerateIntegratedGraphs():GenerateOtherGraphs())}function GenerateCustomGraphs(){var a,b=g_DataList.start;switch(g_GraphType){case 0:for(a=1;a<=g_DataList.size;a++)GraphCustom("region-graphs-"+a,b),b=b.next;break;case 1:for(a=1;a<=g_DataList.size;a++)GraphCustom("region-graphs-"+a,b),b=b.next;break;case 2:sumNode=GenerateSumNode(),GraphCustom("region-graphs-1",sumNode)}}function GenerateIntegratedGraphs(){var a,b,c=g_DataList.start;switch(g_GraphType){case 0:for(b=FindMax(),a=1;a<=g_DataList.size;a++)GraphIntegrated("region-graphs-"+a,c,b),c=c.next;break;case 1:for(b=FindMax(),a=1;a<=g_DataList.size;a++)GraphIntegrated("region-graphs-"+a,c,b),c=c.next;break;case 2:sumNode=GenerateSumNode(),GraphIntegrated("region-graphs-1",sumNode)}}function GenerateOtherGraphs(){var a,b,c=g_DataList.start;switch(g_GraphType){case 0:for(b=FindMax(),a=1;a<=g_DataList.size;a++)GraphRegional("region-graphs-"+a,c,b),c=c.next;break;case 1:GraphCombined("region-graphs-1");break;case 2:sumNode=GenerateSumNode(),GraphRegional("region-graphs-1",sumNode)}}function GraphRegional(a,b,c){var d,e,f,g=GenerateSingleData(b.data[g_StatId].data),h={title:b.name,seriesType:"line",legend:"none",vAxis:{viewWindowMode:"explicit",viewWindow:{min:0,max:c}},hAxis:{title:"Year",format:"####"},series:{0:{color:"white"},1:{type:"area",color:"transparent"},2:{color:"navy"},3:{type:"area",color:"navy"}},isStacked:!0,backgroundColor:"#EAE7C2",tooltip:{trigger:"both"}};if("est"!==g_Stats[g_StatId].type&&(h.series[0].color="navy"),null!==g){for(d=new google.visualization.NumberFormat({pattern:"#,###.##"}),f=1;f<g.getNumberOfColumns();f++)null!==g&&d.format(g,f);return e=new google.visualization.ComboChart(document.getElementById(a)),e.draw(g,h),0}return-1}function GraphCombined(a){var b,c,d,e,f=GenerateCombinedData(),g={seriesType:"line",legend:{position:"top"},vAxis:{viewWindowMode:"explicit",viewWindow:{min:0}},hAxis:{title:"Year",format:"####"},backgroundColor:"#EAE7C2",tooltip:{trigger:"both"}};for(b=[],c=new google.visualization.NumberFormat({pattern:"#,###.##"}),e=1;e<f.getNumberOfColumns();e++)c.format(f,e);d=new google.visualization.LineChart(document.getElementById(a)),d.draw(f,g)}function GraphIntegrated(a,b,c){var d,e,f,g=GenerateSingleData(b.data[g_StatId].data),h={0:{type:"bar"},1:{type:"bar"},2:{type:"bar"}},i={title:b.name,vAxis:{viewWindowMode:"explicit",viewWindow:{min:0,max:1},format:"###%"},hAxis:{title:"Year",format:"####"},backgroundColor:"#EAE7C2",seriesType:"bars",tooltip:{trigger:"both"}};for(c>1&&(i.vAxis.viewWindow.max=c),f=0;f<g_Stats[g_StatId].subType.length;f++)"lin"===g_Stats[g_StatId].subType[f]&&(h[f].type="line");for(i.series=h,d=new google.visualization.NumberFormat({pattern:"##.##%"}),f=1;f<g.getNumberOfColumns();f++)d.format(g,f);e=new google.visualization.ComboChart(document.getElementById(a)),e.draw(g,i)}function GraphCustom(a,b){var c,d=GenerateCustomData(b),e={title:b.name,hAxis:{title:"Year",format:"####"},backgroundColor:"#EAE7C2",seriesType:"line",tooltip:{trigger:"both"}};c=new google.visualization.ComboChart(document.getElementById(a)),c.draw(d,e)}function FixMissingData(a){return-1!==a?a:null}function GetYears(a){var b,c=[],d=new RegExp("y_(\\d+)");for(b in a)"country_id"!==b&&"data_set_index"!==b&&(year=d.exec(b),c.push(Number(year[1])));return c}function GetValues(a){var b,c=[];for(b in a)"country_id"!==b&&"data_set_index"!==b&&c.push(FixMissingData(Number(a[b])));return c}function GenerateSingleData(a){var b;new Array(4);return b="est"===g_Stats[g_StatId].type?GenerateSingleEstData(a):"int"===g_Stats[g_StatId].type?GenerateSingleIntData(a):GenerateSingleOtherData(a)}function GenerateSingleEstData(a){var b,c=[],d=new google.visualization.DataTable;for(c.push(GetYears(a[g_SelectedIndex].values[0])),c.push(GetValues(a[g_SelectedIndex].values[0])),c.push(GetValues(a[g_SelectedIndex].values[1])),c.push(GetValues(a[g_SelectedIndex].values[2])),d.addColumn("number","year"),d.addColumn("number",g_Stats[g_StatId].subName[1]),d.addColumn("number","lower bound space"),d.addColumn("number",g_Stats[g_StatId].subName[2]),d.addColumn("number","size of confidence interval"),d.addColumn("number",g_Stats[g_StatId].subName[0]),b=0;b<c[0].length;b++)d.addRow([c[0][b],c[2][b],c[3][b],c[3][b],c[1][b]-c[3][b],c[1][b]]);return d}function GenerateSingleIntData(a){var b,c=[],d=new google.visualization.DataTable;for(c.push(GetYears(a[g_SelectedIndex].values[0].values)),c.push(GetValues(a[g_SelectedIndex].values[0].values)),c.push(GetValues(a[g_SelectedIndex].values[1].values)),c.push(GetValues(a[g_SelectedIndex].values[2].values)),d.addColumn("number","year"),d.addColumn("number",g_Stats[g_StatId].subName[0]),d.addColumn("number",g_Stats[g_StatId].subName[1]),d.addColumn("number",g_Stats[g_StatId].subName[2]),b=0;b<c[0].length;b++)d.addRow([c[0][b],c[1][b],c[2][b],c[3][b]]);return d}function GenerateSingleOtherData(a){var b,c=[],d=new google.visualization.DataTable;for(d.addColumn("number","year"),d.addColumn("number",g_Stats[g_StatId].name),c.push(GetYears(a[g_SelectedIndex].values)),c.push(GetValues(a[g_SelectedIndex].values)),b=0;b<c[0].length;b++)d.addRow([c[0][b],c[1][b]]);return d}function GenerateCustomData(a){var b,c,d=[],e=[],f=new google.visualization.DataTable;for(console.log(g_StatId1),console.log(g_SelectedIndex1),f.addColumn("number","year"),"int"!==g_Stats[g_StatId1].type?f.addColumn("number",g_Stats[g_StatId1].name):f.addColumn("number",g_Stats[g_StatId1].subName[g_SubStat1]),"int"!==g_Stats[g_StatId2].type?f.addColumn("number",g_Stats[g_StatId2].name):f.addColumn("number",g_Stats[g_StatId2].subName[g_SubStat2]),"est"===g_Stats[g_StatId1].type?(d.push(GetYears(a.data[g_StatId1].data[g_SelectedIndex1].values[1])),d.push(GetValues(a.data[g_StatId1].data[g_SelectedIndex1].values[1]))):"int"===g_Stats[g_StatId1].type?(d.push(GetYears(a.data[g_StatId1].data[g_SelectedIndex1].values[g_SubStat1].values)),d.push(GetValues(a.data[g_StatId1].data[g_SelectedIndex1].values[g_SubStat1].values))):(d.push(GetYears(a.data[g_StatId1].data[g_SelectedIndex1].values)),d.push(GetValues(a.data[g_StatId1].data[g_SelectedIndex1].values))),console.log(g_StatId2),console.log(g_SelectedIndex2),"est"===g_Stats[g_StatId2].type?(e.push(GetYears(a.data[g_StatId2].data[g_SelectedIndex2].values[1])),e.push(GetValues(a.data[g_StatId2].data[g_SelectedIndex2].values[1]))):"int"===g_Stats[g_StatId2].type?(e.push(GetYears(a.data[g_StatId2].data[g_SelectedIndex2].values[g_SubStat2].values)),e.push(GetValues(a.data[g_StatId2].data[g_SelectedIndex2].values[g_SubStat2].values))):(e.push(GetYears(a.data[g_StatId2].data[g_SelectedIndex2].values)),e.push(GetValues(a.data[g_StatId2].data[g_SelectedIndex2].values))),c=0,b=0;d[0][b]!==e[0][c];)c++;if(d[0][b]!==e[0][c])for(c=0;d[0][b]!==e[0][c];)b++;for(b=b;b<d[0].length;b++)f.addRow([d[0][b],d[1][b],e[1][c]]),c++;return f}function GenerateCombinedData(){var a,b,c,d,e=new google.visualization.DataTable,f=new Array(g_DataList.size+1);for(e.addColumn("number","year"),c=g_DataList.start,a=0;a<g_DataList.size;a++)e.addColumn("number",c.name),c=c.next;if(c=g_DataList.start,"est"===g_Stats[g_StatId].type)for(f[0]=GetYears(c.data[g_StatId].data[g_SelectedIndex].values[1]),a=0;a<g_DataList.size;a++)f[a+1]=GetValues(c.data[g_StatId].data[g_SelectedIndex].values[1]),c=c.next;else for(f[0]=GetYears(c.data[g_StatId].data[g_SelectedIndex].values),a=0;a<g_DataList.size;a++)f[a+1]=GetValues(c.data[g_StatId].data[g_SelectedIndex].values),c=c.next;for(a=0;a<f[0].length;a++){for(d=[],b=0;b<f.length;b++)d.push(f[b][a]);e.addRow(d)}return e}function GenerateSumNode(){var a,b,c,d,e,f="";for(c=g_DataList.start,a=jQuery.extend(!0,{},g_Data[c.cc2]),f+=c.name,c=c.next,d=1;d<g_DataList.size;d++)f+=", "+c.name,"custom"===g_StatId?(a[g_StatId1].data=AddValuesFromNode(a[g_StatId1].data,c,g_StatId1,g_SelectedIndex1),g_StatId1!==g_StatId2&&(a[g_StatId2].data=AddValuesFromNode(a[g_StatId2].data,c,g_StatId2,g_SelectedIndex2))):a[g_StatId].data=AddValuesFromNode(a[g_StatId].data,c,g_StatId,g_SelectedIndex),c=c.next;if("custom"!==g_StatId&&"int"===g_Stats[g_StatId].type)for(e=g_Data[g_DataList.start.cc2][g_StatId].firstYear;e<=g_Data[g_DataList.start.cc2][g_StatId].lastYear;e++)b[g_SelectedIndex].values[0].values["y_"+e]=b[g_SelectedIndex].values[0].values["y_"+e]/g_DataList.size,b[g_SelectedIndex].values[1].values["y_"+e]=b[g_SelectedIndex].values[0].values["y_"+e]/g_DataList.size,b[g_SelectedIndex].values[2].values["y_"+e]=b[g_SelectedIndex].values[0].values["y_"+e]/g_DataList.size;return sumNode=new t_AsdsNode("sum",f,a),sumNode}function AddValuesFromNode(a,b,c,d){if("est"===g_Stats[c].type)for(j=g_Data[b.cc2][c].firstYear;j<=g_Data[b.cc2][c].lastYear;j++)a[d].values[0]["y_"+j]=Number(a[d].values[0]["y_"+j]),-1!==Number(g_Data[b.cc2][c].data[d].values[0]["y_"+j])&&(a[d].values[0]["y_"+j]+=Number(g_Data[b.cc2][c].data[d].values[0]["y_"+j])),a[d].values[1]["y_"+j]=Number(a[d].values[1]["y_"+j]),-1!==Number(g_Data[b.cc2][c].data[d].values[1]["y_"+j])&&(a[d].values[1]["y_"+j]+=Number(g_Data[b.cc2][c].data[d].values[1]["y_"+j])),a[d].values[2]["y_"+j]=Number(a[d].values[2]["y_"+j]),-1!==Number(g_Data[b.cc2][c].data[d].values[2]["y_"+j])&&(a[d].values[2]["y_"+j]+=Number(g_Data[b.cc2][c].data[d].values[2]["y_"+j]));else if("int"===g_Stats[c].type)for(j=g_Data[b.cc2][c].firstYear;j<=g_Data[b.cc2][c].lastYear;j++)a[d].values[0].values["y_"+j]=Number(a[d].values[0].values["y_"+j]),-1!==Number(g_Data[b.cc2][c].data[d].values[0].values["y_"+j])&&(a[d].values[0].values["y_"+j]+=Number(g_Data[b.cc2][c].data[d].values[0].values["y_"+j])),a[d].values[1].values["y_"+j]=Number(a[d].values[1].values["y_"+j]),-1!==Number(g_Data[b.cc2][c].data[d].values[1].values["y_"+j])&&(a[d].values[1].values["y_"+j]+=Number(g_Data[b.cc2][c].data[d].values[1].values["y_"+j])),3===a[d].length&&(a[d].values[2].values["y_"+j]=Number(a[d].values[2].values["y_"+j]),-1!==Number(g_Data[b.cc2][c].data[d].values[2]["y_"+j])&&(a[d].values[2].values["y_"+j]+=Number(g_Data[b.cc2][c].data[d].values[2].values["y_"+j])));else for(j=g_Data[b.cc2][c].firstYear;j<=g_Data[b.cc2][c].lastYear;j++)a[d].values["y_"+j]=Number(a[d].values["y_"+j]),-1!==Number(g_Data[b.cc2][c].data[d].values["y_"+j])&&(a[d].values["y_"+j]+=Number(g_Data[b.cc2][c].data[d].values["y_"+j]));return a}function GetMaxFromValueRow(a){var b,c,d=Number.MIN_VALUE,e=new RegExp("y_(\\d+)");for(c in a)"country_id"!==c&&"data_set_index"!==c&&(b=e.exec(c),year=Number(b[1]),year>=g_YearStart&&year<=g_YearEnd&&Number(a[c])>d&&(d=Number(a[c])));return d}function FindMax(){var a,b,c=Number.MIN_VALUE,d=g_DataList.start;for(a=0;a<g_DataList.size;a++)b=GetMaxThisNode(d),b>c&&(c=b),d=d.next;return 0>c||void 0===c||c===Number.MIN_VALUE?-1:c}function GetMaxThisNode(a){var b;return b="est"===g_Stats[g_StatId].type?Math.max.apply(Math,[GetMaxFromValueRow(a.data[g_StatId].data[g_SelectedIndex].values[0]),GetMaxFromValueRow(a.data[g_StatId].data[g_SelectedIndex].values[1]),GetMaxFromValueRow(a.data[g_StatId].data[g_SelectedIndex].values[2])]):"int"===g_Stats[g_StatId].type?Math.max.apply(Math,[GetMaxFromValueRow(a.data[g_StatId].data[g_SelectedIndex].values[0].values),GetMaxFromValueRow(a.data[g_StatId].data[g_SelectedIndex].values[1].values),GetMaxFromValueRow(a.data[g_StatId].data[g_SelectedIndex].values[2].values)]):GetMaxFromValueRow(a.data[g_StatId].data[g_SelectedIndex].values)}function BuildTabs(){var a;for(a in g_Stats)g_Stats.hasOwnProperty(a)&&document.getElementById("tabsDiv").appendChild(CreateTab(g_Stats[a].name,a));document.getElementById("tabsDiv").appendChild(CreateTab("Custom","custom"))}function CreateTab(a,b){var c;return c=document.createElement("div"),c.id="id-"+b,c.setAttribute("stat",b),c.className="graph-tab",c.setAttribute("onclick","ChooseTab(this)"),c.innerHTML=a,BuildDiv(b),b===g_StatId&&(document.getElementById("id-"+b+"-graphs").style.display="block",document.getElementById("id-"+b+"-dropdown").style.display="block",c.className="graph-tab selected-tab"),c}function UpdateInputs(){var a=document.getElementById("year-range-start"),b=document.getElementById("year-range-end"),c=document.getElementById("heatmap-year");a.max=g_LastYear,a.min=g_FirstYear,b.max=g_LastYear,b.min=g_FirstYear,c.max=g_LastYear,c.min=g_FirstYear,g_TempSettings[0]=g_FirstYear,g_TempSettings[1]=g_LastYear,g_TempSettings[2]=g_LastYear,g_TempSettings[3]=0,g_TempSettings[4]=0}function BuildDiv(a){var b=document.createElement("DIV");b.id="id-"+a+"-graphs",b.style.display="none",b.style.top="23%",b.style.height="72%",b.className="graph",document.getElementById("graphs").appendChild(BuildDropdown(a)),document.getElementById("graphs").appendChild(b)}function BuildDropdown(a){var b=document.createElement("DIV"),c="";return b.id="id-"+a+"-dropdown",b.style.display="none",b.style.top="8%",b.style.height="15%",c+="custom"===a?GetCustomDropdownHTML():GetDropdownHTML(a),b.innerHTML=c,b}function GetDropdownHTML(a){var b,c="";c+="<p class='open-sans'>Select Data Set</p><select id='stat-indices-"+a+"' name='index' onchange=\"SelectIndex('stat-indices-"+a+"')\">";for(b in g_Stats[a].tags)g_Stats[a].tags.hasOwnProperty(b)&&(c+="<option value='"+b+"'>"+b+" - ",c+=""===g_Stats[a].tags[b]?"untagged":g_Stats[a].tags[b],c+="</option></br>");return c+="</select>"}function GetCustomDropdownHTML(){var a,b,c="";c+="<p class='open-sans' id='stats-select'>Select Stats</p><p class='open-sans' id='indices-select'>Select Data Sets</p><select id='stat1' name='stat1' onchange=\"SelectStat('stat1')\">";for(a in g_Stats)if(g_Stats.hasOwnProperty(a))if("int"===g_Stats[a].type)for(b=0;b<g_Stats[a].subName.length;b++)c+="<option value='"+a+"+"+b+"'>"+g_Stats[a].name+" - "+g_Stats[a].subName[b]+"</option>";else c+="<option value='"+a+"'>"+g_Stats[a].name+"</option>";c+="</select>",c+="<select id='stat2' name='stat2' onchange=\"SelectStat('stat2')\">";for(a in g_Stats)if(g_Stats.hasOwnProperty(a))if("int"===g_Stats[a].type)for(b=0;b<g_Stats[a].subName.length;b++)c+="<option value='"+a+"+"+b+"'>"+g_Stats[a].name+" - "+g_Stats[a].subName[b]+"</option>";else c+="<option value='"+a+"'>"+g_Stats[a].name+"</option>";c+="</select>",c+="<select id='stat1index' name='stat1index' onchange=\"SelectIndex('stat1index')\">";for(a in g_Stats[g_StatId1].tags)g_Stats[g_StatId1].tags.hasOwnProperty(a)&&(c+="<option value='"+a+"'>"+a+" - ",c+=""===g_Stats[g_StatId1].tags[a]?"untagged":g_Stats[g_StatId1].tags[a],c+="</option></br>");c+="</select>",c+="<select id='stat2index' name='stat2index' onchange=\"SelectIndex('stat2index')\">";for(a in g_Stats[g_StatId2].tags)g_Stats[g_StatId2].tags.hasOwnProperty(a)&&(c+="<option value='"+a+"'>"+a+" - ",c+=""===g_Stats[g_StatId2].tags[a]?"untagged":g_Stats[g_StatId2].tags[a],c+="</option></br>");return c+="</select>"}function RefreshIndices(a){var b,c="";if("stat1index"===a)for(b in g_Stats[g_StatId1].tags)g_Stats[g_StatId1].tags.hasOwnProperty(b)&&(c+="<option value='"+b+"'>"+b+" - ",c+=""===g_Stats[g_StatId1].tags[b]?"untagged":g_Stats[g_StatId1].tags[b],c+="</option></br>");else for(b in g_Stats[g_StatId2].tags)g_Stats[g_StatId2].tags.hasOwnProperty(b)&&(c+="<option value='"+b+"'>"+b+" - ",c+=""===g_Stats[g_StatId2].tags[b]?"untagged":g_Stats[g_StatId2].tags[b],c+="</option></br>");document.getElementById(a).innerHTML=c}function ChooseTab(a){var b,c,d="";g_SelectedIndex=0,b="id-"+g_StatId+"-graphs",document.getElementById(b).innerHTML="",c=document.getElementById("id-"+g_StatId),c.className="graph-tab",a.className="graph-tab selected-tab",document.getElementById("id-"+g_StatId+"-graphs").style.display="none",document.getElementById("id-"+g_StatId+"-dropdown").style.display="none",document.getElementById(a.id+"-graphs").style.display="block",document.getElementById(a.id+"-dropdown").style.display="block",g_StatId=a.getAttribute("stat"),"custom"!==g_StatId&&ColorByHms(),document.getElementById(a.id+"-graphs").innerHTML=d,GenerateSubDivs(),(0===g_GraphType||1===g_GraphType&&("custom"===g_StatId||"int"===g_Stats[g_StatId].type))&&FixDivSize(),GenerateGraphs()}function RotateTabs(a){var b,c=document.getElementById("tabsDiv"),d=c.childNodes;a>0?(b=d[0],c.removeChild(b),c.appendChild(b)):(b=d[d.length-1],c.removeChild(b),c.insertBefore(b,d[0]))}function SwitchToMain(){$(".loading-screen").fadeOut(750)}function OpenSettings(){ResetAllStatValues(),$(".settings-screen, .settings-black").fadeIn(400)}function CloseSettings(){$(".settings-screen, .settings-black").fadeOut(400);var a=document.getElementById("year-range-start"),b=document.getElementById("year-range-end"),c=document.getElementById("heatmap-year");a.style["box-shadow"]="",b.style["box-shadow"]="",c.style["box-shadow"]="",document.getElementById(a.id+"-error").innerHTML="",document.getElementById(b.id+"-error").innerHTML="",document.getElementById(c.id+"-error").innerHTML=""}function OpenHelp(){$(".help-screen, .help-black").fadeIn(400)}function CloseHelp(){$(".help-screen, .help-black").fadeOut(400)}function Expand(){$(".control-panel").animate({width:"97.5%"},500),$("#expand").attr("onclick","Shrink()"),$("#expand").attr("src","res/arrow_left.png"),$("#scroll-left").fadeOut(400),$("#scroll-right").fadeOut(400),$(".expand-black").fadeIn(400),setTimeout(function(){void 0!==g_DataList&&0!==g_DataList.size&&(g_Expanded=!0,GenerateSubDivs(),1===g_GraphType&&("custom"!==g_StatId||"int"!==g_StatList[g_StatId].type)||2===g_GraphType?(document.getElementById("region-graphs-1").style.width="100%",document.getElementById("region-graphs-1").style.height="100%"):FixDivSize(),GenerateGraphs())},500)}function Shrink(){$(".control-panel").animate({width:"25%"},500),$("#expand").attr("onclick","Expand()"),$("#expand").attr("src","res/arrow_right.png"),$("#scroll-left").fadeIn(400),$("#scroll-right").fadeIn(400),$(".expand-black").fadeOut(400),setTimeout(function(){g_Expanded=!1,GenerateSubDivs(),FixDivSize(),GenerateGraphs()},500)}function GenerateSubDivs(){var a,b,c;void 0!==g_DataList&&(a="id-"+g_StatId+"-graphs",b=document.getElementById(a).childNodes.length,c=document.getElementById(a).childNodes,1===g_GraphType&&"custom"!==g_StatId&&"int"!==g_Stats[g_StatId].type||2===g_GraphType?(document.getElementById(a).innerHTML="",0!==g_DataList.size&&CreateSubDiv("region-graphs-1",a),g_Expanded&&(document.getElementById("region-graphs-1").style.width="100%",document.getElementById("region-graphs-1").style.height="100%")):FixDivNum(b,a))}function FixDivNum(a,b){for(;g_DataList.size<a;)$("#region-graphs-"+a).remove(),a--;for(;g_DataList.size>a;)CreateSubDiv("region-graphs-"+(a+1),b),a++}function CreateSubDiv(a,b){var c,d=document.createElement("div");d.id=a,d.className="subgraph",c=document.getElementsByTagName("div"),document.getElementById(b).appendChild(d),g_Expanded&&(0===g_GraphType||"int"===g_Stats[g_StatId].type&&1===g_GraphType)&&$(d).click(function(){"100%"!==document.getElementById(a).style.width?(document.getElementById(d.id).style.width="100%",document.getElementById(d.id).style.height="100%"):(document.getElementById(d.id).style.width="50%",document.getElementById(d.id).style.height="50%"),GenerateGraphs()})}function FixDivSize(){var a;for(a=0;a<g_DataList.size;a++)g_Expanded?document.getElementById("region-graphs-"+(a+1)).style.width="50%":document.getElementById("region-graphs-"+(a+1)).style.width="100%",document.getElementById("region-graphs-"+(a+1)).style.height="50%"}function teamPopup(){window.alert("Stateware Team\nSpring 2015:\nWilliam Bittner, Joshua Crafts, Nicholas Denaro, Dylan Fetch, Paul Jang, Arun Kumar, Drew Lopreiato, Kyle Nicholson, Emma Roudabush, Berty Ruan, Vanajam Soni")}function bugPopup(){window.alert("If you would like to report an issue, please send an email to stateware@acm.psu.edu with the following details included in your message:\n1. Description of the issue\n2. Steps for reproducing the issue\n3. What browser and operating system you experienced the issue on\n4. Any additional relevant information.")}var g_BUCKETS=676,g_Data,g_Countries,g_Stats,g_SelectedIndex=0,g_Diseases,g_FirstYear,g_LastYear,g_YearStart,g_YearEnd,g_DataList,g_StatId,g_StatId1,g_SelectedIndex1=0,g_SubStat1,g_StatId2,g_SelectedIndex2=0,g_SubStat2,g_HmsYear,g_GraphType=0,g_Clear=!1,g_Expanded=!1,g_IntHms=0,g_TempSettings=new Array(5),g_Map;